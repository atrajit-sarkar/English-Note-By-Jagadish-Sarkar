\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{book-theme}[2025/11/29 MEXT Grammar Theme]

% Packages
% inputenc and fontenc removed for XeLaTeX compatibility
\RequirePackage{lmodern}
\RequirePackage{microtype}
\RequirePackage[a4paper,margin=25mm,top=30mm,headheight=15pt]{geometry} % Fixed geometry
\RequirePackage{setspace}
\RequirePackage{parskip}
\RequirePackage{amsmath,amssymb}
\RequirePackage{graphicx}
\RequirePackage{tikz}
\usetikzlibrary{arrows.meta,shapes.geometric,shapes.symbols,positioning,calc,decorations.pathreplacing,shadows}
\RequirePackage{hyperref}
\RequirePackage{booktabs}
\RequirePackage{enumitem}
\RequirePackage{tcolorbox}
\tcbuselibrary{skins}
\RequirePackage{caption}
\RequirePackage{longtable}
\RequirePackage{multicol}
\RequirePackage{fancyhdr}
\RequirePackage{xcolor}

% Colors
\definecolor{primary}{RGB}{34,79,121}
\definecolor{accent}{RGB}{203,75,75}
\hypersetup{colorlinks=true,linkcolor=primary,citecolor=accent,urlcolor=primary}

% Page geometry and header
\pagestyle{fancy}
\fancyhf{}
\renewcommand{\headrulewidth}{0.6pt}
\fancyhead[L]{\textsc{English Grammar}}
\fancyhead[R]{\textsc{\leftmark}}
\fancyfoot[C]{\thepage}

% Theorem-like boxes for examples, notes
\newtcolorbox{definitionbox}{
    colback=primary!5!white,
    colframe=primary!60!black,
    sharp corners,
    boxrule=0.8pt,
    left=5pt,
    right=5pt,
    top=5pt,
    bottom=5pt
}
\newtcolorbox{examplebox}{
    colback=accent!5!white,
    colframe=accent!60!black,
    sharp corners,
    boxrule=0.8pt,
    left=5pt,
    right=5pt,
    top=5pt,
    bottom=5pt
}
\newtcolorbox{exercisebox}{
    colback=white,
    colframe=primary!40!black,
    sharp corners,
    boxrule=0.6pt,
    left=5pt,
    right=5pt,
    top=5pt,
    bottom=5pt
}

% image box command
\newcommand{\imagebox}[3]{
    \begin{center}
    \begin{tikzpicture}
        \node[anchor=south west, inner sep=0] (image) at (0,0) {\includegraphics[width=2.5cm]{#1}};
        
        % Main text box with cloud-like rounded shape
        \node[align=left, text width=10cm, anchor=west, draw=primary, fill=white, inner sep=10pt, drop shadow, rounded corners=15pt] (textbox) at (3, 1.5) {\textbf{\underline{#2}} \\ #3};
        
        % Small thinking cloud bubbles leading to the text box
        \node[cloud, draw=primary, fill=white, cloud puffs=10, cloud puff arc=120, aspect=2, inner sep=1pt] at (2.3, 1.2) {};
        \node[cloud, draw=primary, fill=white, cloud puffs=10, cloud puff arc=120, aspect=2, inner sep=2pt] at (2.6, 1.4) {};
    \end{tikzpicture}
    \end{center}
}

% Commands
\newcommand{\term}[1]{\textbf{\underline{#1}}}
\newcommand{\highlight}[1]{\colorbox{yellow!40}{\textbf{\textcolor{black}{#1}}}}
\newcommand{\ex}[1]{\vspace{3pt}\begin{examplebox}\textbf{Example: }#1\end{examplebox}\vspace{3pt}}
\newcommand{\sol}[1]{\begin{tcolorbox}[colback=black!5!white,colframe=black!30!white]{\textbf{Solution:} }#1\end{tcolorbox}}
\newcommand{\note}[3]{\begin{tcolorbox}[colback=yellow!10!white,colframe=orange!70!red,boxrule=1pt,sharp corners,left=5pt,right=5pt,top=5pt,bottom=5pt]{\textbf{\textcolor{red}{\emoji{#1} #2}}} #3\end{tcolorbox}}

\endinput